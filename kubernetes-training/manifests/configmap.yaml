apiVersion: v1
kind: ConfigMap
metadata:
  name: nb-config
  namespace: networkbuster
  labels:
    app: networkbuster
    component: configuration
data:
  # Global configuration
  SECURITY_PIN: "drew2"
  LOG_LEVEL: "INFO"
  ENVIRONMENT: "training"
  OWNER: "NetworkBuster"
  
  # Service-specific ports
  SERVICES_MANAGER_PORT: "8080"
  ROBOT_RECYCLING_PORT: "5000"
  SUDO_MANAGER_PORT: "8081"
  STATUS_DASHBOARD_PORT: "8082"
  TOKEN_MANAGER_PORT: "8083"
  LICENSE_MANAGER_PORT: "8084"
  
  # Feature flags
  ENABLE_MONITORING: "true"
  ENABLE_LOGGING: "true"
  ENABLE_METRICS: "true"
  
  # Timeouts and intervals
  HEALTH_CHECK_INTERVAL: "30s"
  TOKEN_EXPIRY: "3600"
  REFRESH_INTERVAL: "5"
  
  # Database
  DATABASE_TYPE: "sqlite"
  DATABASE_PATH: "/app/data"
  
  # Logging configuration
  log-config.json: |
    {
      "version": 1,
      "disable_existing_loggers": false,
      "formatters": {
        "standard": {
          "format": "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
        },
        "json": {
          "format": "{\"timestamp\": \"%(asctime)s\", \"logger\": \"%(name)s\", \"level\": \"%(levelname)s\", \"message\": \"%(message)s\"}"
        }
      },
      "handlers": {
        "console": {
          "class": "logging.StreamHandler",
          "level": "INFO",
          "formatter": "standard",
          "stream": "ext://sys.stdout"
        },
        "file": {
          "class": "logging.handlers.RotatingFileHandler",
          "level": "INFO",
          "formatter": "json",
          "filename": "/app/logs/app.log",
          "maxBytes": 10485760,
          "backupCount": 5
        }
      },
      "root": {
        "level": "INFO",
        "handlers": ["console", "file"]
      }
    }

---
apiVersion: v1
kind: ConfigMap
metadata:
  name: nginx-config
  namespace: networkbuster
data:
  nginx.conf: |
    events {
        worker_connections 1024;
    }
    
    http {
        upstream services-manager {
            server services-manager:8080;
        }
        
        upstream robot-recycling {
            server robot-recycling:5000;
        }
        
        upstream sudo-manager {
            server sudo-manager:8081;
        }
        
        upstream status-dashboard {
            server status-dashboard:8082;
        }
        
        upstream token-manager {
            server token-manager:8083;
        }
        
        upstream license-manager {
            server license-manager:8084;
        }
        
        server {
            listen 80;
            server_name localhost;
            
            # Security PIN header check
            if ($http_x_security_pin != "drew2") {
                return 403;
            }
            
            location /services/ {
                proxy_pass http://services-manager/;
                proxy_set_header Host $host;
                proxy_set_header X-Real-IP $remote_addr;
            }
            
            location /robots/ {
                proxy_pass http://robot-recycling/;
                proxy_set_header Host $host;
                proxy_set_header X-Real-IP $remote_addr;
            }
            
            location /sudo/ {
                proxy_pass http://sudo-manager/;
                proxy_set_header Host $host;
                proxy_set_header X-Real-IP $remote_addr;
            }
            
            location /dashboard/ {
                proxy_pass http://status-dashboard/;
                proxy_set_header Host $host;
                proxy_set_header X-Real-IP $remote_addr;
            }
            
            location /tokens/ {
                proxy_pass http://token-manager/;
                proxy_set_header Host $host;
                proxy_set_header X-Real-IP $remote_addr;
            }
            
            location /licenses/ {
                proxy_pass http://license-manager/;
                proxy_set_header Host $host;
                proxy_set_header X-Real-IP $remote_addr;
            }
            
            location /health {
                return 200 "NetworkBuster Healthy\n";
                add_header Content-Type text/plain;
            }
        }
    }
